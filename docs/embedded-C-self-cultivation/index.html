<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-stm32/embedded-C-self-cultivation">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">嵌入式C语言自我修养笔记 - pansyhou的小站</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pansyhou.github.io/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://pansyhou.github.io/img/logo.png"><meta data-rh="true" property="og:url" content="https://pansyhou.github.io/docs/embedded-C-self-cultivation"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="keywords" content="pansyhou"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="嵌入式C语言自我修养笔记 - pansyhou的小站"><meta data-rh="true" name="description" content="java不着急，看他们卷的我难受，都说java很卷，那我走，走计科行不行，咱先把计科的基础打好行不行？"><meta data-rh="true" property="og:description" content="java不着急，看他们卷的我难受，都说java很卷，那我走，走计科行不行，咱先把计科的基础打好行不行？"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pansyhou.github.io/docs/embedded-C-self-cultivation"><link data-rh="true" rel="alternate" href="https://pansyhou.github.io/docs/embedded-C-self-cultivation" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://pansyhou.github.io/docs/embedded-C-self-cultivation" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GV6YN1ODMO-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S4SD5NXWXF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S4SD5NXWXF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="pansyhou的小站" href="/opensearch.xml">
<link rel="preconnect" href="https://matomo.kuizuo.cn/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://matomo.kuizuo.cn/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>


<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9a3849aa75f9c4a4e65f846cd1a5155",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="pansyhou RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="pansyhou Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="pansyhou JSON Feed">

<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)">
<meta name="description" content="pansyhou的个人博客">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4d5ec00a.css">
<link rel="preload" href="/assets/js/runtime~main.b46bdf30.js" as="script">
<link rel="preload" href="/assets/js/main.1772e4c3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="pansyhou" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="pansyhou" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">pansyhou</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">学习</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/skill/">笔记</a></li><li><a class="dropdown__link" href="/docs/oi/">刷题</a></li><li><a class="dropdown__link" href="/tags">标签</a></li><li><a class="dropdown__link" href="/archive">归档</a></li><li><a class="dropdown__link" href="/docs/english/">英语</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">嵌入式开发</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/stm32/">STM32</a></li><li><a class="dropdown__link" href="/docs/ros/">ROS</a></li><li><a class="dropdown__link" href="/docs/Android/">Android</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/ysyx/">一生一芯</a><a class="navbar__item navbar__link" href="/resource">导航</a><a class="navbar__item navbar__link" href="/project">项目</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文（中国）</a><ul class="dropdown__menu"><li><a href="/docs/embedded-C-self-cultivation" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中文（中国）</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为暗黑模式）" aria-label="切换浅色/暗黑模式（当前为暗黑模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.webp" alt="pansyhou" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="pansyhou" class="themedImage_ToTc themedImage--dark_i4oU"><b>pansyhou</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/stm32">开发工具推荐</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/uart-send-recv">串口收发的几种方式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/motion-planning">运动轨迹规划</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/arm_dev_note">arm嵌入式系统开发笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/22_embedded_task">22电控任务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/upgrade-your-fuxking-compiler">升级AC6编译器（支持Cmake）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/embedded-C-self-cultivation">嵌入式C语言自我修养笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/usb-application">usb从实践到理论</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">嵌入式C语言自我修养笔记</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>前言</h1><p>java不着急，看他们卷的我难受，都说java很卷，那我走，走计科行不行，咱先把计科的基础打好行不行？</p><p>而且我嵌入式写的时候感觉一直在cv别人家的代码，缺乏自己的思考，也缺少经验优化相关代码，想要养成看武林秘籍（书）的习惯，所以，来！先看这个吧，下面是作者对我们需要理解学习的知识体系和编程技能</p><ul><li><p>半导体基础、CPU工作原理、硬件电路、计算机系统结构。</p></li><li><p>ARM体系结构与汇编指令、汇编程序设计、ARM反汇编分析。</p></li><li><p><strong>程序的编译、链接、安装、运行和重定位分析。</strong></p></li><li><p>熟悉C语言标准、ARM、GNU编译器的特性和扩展语法。</p></li><li><p>C语言的模块化编程思想，学会使用模块化思想去分析复杂的系统。</p></li><li><p><strong>C语言的面向对象编程（简称OOP）思想，学会使用OOP思想去分析Linux内核驱动。</strong></p></li><li><p>对指针的深刻理解，对复杂指针的声明和灵活应用。</p><ul><li>对内存堆栈管理、内存泄漏、栈溢出、段错误的深刻理解。</li></ul></li><li><p><strong>多任务并发编程思想，CPU和操作系统基础理论。</strong></p></li></ul><p>[TOC]</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="工欲善其事必先利其器">工欲善其事，必先利其器<a href="#工欲善其事必先利其器" class="hash-link" aria-label="工欲善其事，必先利其器的直接链接" title="工欲善其事，必先利其器的直接链接">​</a></h2><p>这里作者给我们强烈安利了一波vim，但是我这用keil的人暂时用不上就不学了</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="程序编译工具make">程序编译工具：make<a href="#程序编译工具make" class="hash-link" aria-label="程序编译工具：make的直接链接" title="程序编译工具：make的直接链接">​</a></h3><p>现在的IDE会自动调用相关的<strong>预处理器、编译器、汇编器、链接器</strong>等工具生成可执行文件，并将可执行文件加载到内存运行，通过打印窗口，用户可以很直观地看到程序的运行结果。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用gcc编译c源程序">使用gcc编译C源程序<a href="#使用gcc编译c源程序" class="hash-link" aria-label="使用gcc编译C源程序的直接链接" title="使用gcc编译C源程序的直接链接">​</a></h4><p>在Linux环境下编译程序和在Windows下不太一样，一般在命令行下编译代码。在Linux下，我们一般使用gcc或arm-linux-gcc交叉编译器来编译程序。在使用这些编译器之前，首先需要安装它们，在Ubuntu环境下，我们可以使用apt-get命令来安装这些编译工具。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="make编译工具">make编译工具<a href="#make编译工具" class="hash-link" aria-label="make编译工具的直接链接" title="make编译工具的直接链接">​</a></h4><p>依赖一个叫作Makefile的文件：生成一个可执行文件所依赖的所有C源文件都在这个Makefile文件中指定。在Makefile中，通过定义一个个规则，来描述各个要生成的目标文件所依赖的源文件及编译命令，最后链接器将这些目标文件组装在一起，生成可执行文件。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cpu性能提升流水线">CPU性能提升：流水线<a href="#cpu性能提升流水线" class="hash-link" aria-label="CPU性能提升：流水线的直接链接" title="CPU性能提升：流水线的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="流水线工作原理">流水线工作原理<a href="#流水线工作原理" class="hash-link" aria-label="流水线工作原理的直接链接" title="流水线工作原理的直接链接">​</a></h3><p>一条指令的执行一般要经过取指令、翻译指令、执行指令3个基本流程。CPU内部的电路分为不同的单元：取指单元、译码单元、执行单元等，指令的执行也是按照流水线工序一步一步执行的。</p><p>如图所示，我们假设每一个步骤的执行时间都是一个时钟周期，那么一条指令执行完需要3个时钟周期。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/62f7578c16f2c2beb1703161.png" alt="image-20220813154912496" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="超流水线技术">超流水线技术<a href="#超流水线技术" class="hash-link" aria-label="超流水线技术的直接链接" title="超流水线技术的直接链接">​</a></h3><p>大概就是将木桶效应中的明显短板（用时长的功能）优化，将其细节分摊开，拆分工作，每一个工序的执行时间变小，处理器的时钟周期就可以更短，cpu工作频率就可以更高（虽然说我感觉这部分讲的很逆天.</p><p>流水线通过减少每一道工序的耗费时间来提升整条流水线的效率。在CPU内部也是如此，CPU内部的数字电路是靠时钟驱动来工作的，既然每条指令的执行时钟周期数不变，即执行每条指令都需要3个时钟周期，但是我们可以通过缩短一个时钟周期的时间来提升效率，即减少每条指令所耗费的时间。一个时钟周期的时间变短，CPU主频也就相应提升，影响时钟周期时间长短的一个关键的制约因素就是CPU内部每一个工序执行单元的耗费时间。虽说电信号在电路中的传播时间很快，可以接近光速，但是经过成千上万个晶体管，不停地信号翻转，还是会带来一定的时间延迟，这个时间延迟我们可以看作电路单元的执行时间。以图2-37为例，如果每个执行单元的时间延迟都是1+0.5=1.5ns，那么你的时钟周期至少也得2ns，否则电路就会工作异常。如果驱动CPU工作的时钟周期是2ns，那么CPU的主频就是500MHz。现在的CPU流水线深度可以做到10级以上，流水线的每一级时间延迟都可以做到皮秒级别，驱动CPU工作的时钟周期可以做到更短，可以把CPU的主频飙到5GHz以上。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/62f8a00b16f2c2beb1d7596a.png" alt="image-20220814151046811" class="img_ev3q"></p><p>我们把5级以上的流水线称为超流水线结构。为了提升CPU主频，高性能的处理器一般都会采用这种超流水线结构。Intel的i7处理器有16级流水线，AMD的速龙64系列CPU有20级流水线，史上具有最长流水线的处理器是Intel的第三代奔腾四处理器，有31级流水线。</p><p>要想提升CPU的主频，本质在于减少流水线中每一级流水的执行时间，消除木桶短板效应。解决方法有三个：一是优化流水线中各级流水线的性能，受限于当前集成电路的设计水平，这一步最难；二是依靠半导体制造工艺，工艺制程越先进，芯片面积就会越小，发热也就越小，就更容易提升主频；三是不断地增加流水线深度，流水线越深，流水线中的各级时间延迟就可以做得越小，就更容易提高主频。</p><p>流水线是否越深越好呢？不一定。流水线的本质是拿空间换时间，流水线越深，电路会越复杂，就需要更多的组合逻辑电路和寄存器，芯片面积也就越大，功耗也就随之上升了。用功耗增长换来性能提升，在PC机和服务器上还行，但对于很多靠电池供电的移动设备的处理器来说就无法接受了，CPU设计人员需要在性能和功耗之间做一个很好的平衡。（12代酷睿出现了大小核的设计呢，power and efficient core</p><p>流水线越深，就越能提升性能吗？也不一定。流水线是靠指令的并行来提升性能的，第一条指令还没有执行完，下面的第二条指令就开始取指、译码了。<strong>执行的程序指令如果是顺序结构的，没有中断或跳转，流水线确实可以提高执行效率。但是当程序指令中存在跳转、分支结构时，下面预取的指令可能就要全部丢掉了，需要到跳转的地方重新取指令执行。</strong>(这部分感觉不是很懂，重新开流水线不行吗，但是流水线过长的确实有点难搞)</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="流水线冒险hazard">流水线冒险（hazard）<a href="#流水线冒险hazard" class="hash-link" aria-label="流水线冒险（hazard）的直接链接" title="流水线冒险（hazard）的直接链接">​</a></h3><p>大概就是，提前执行（预取和译码）了下面的指令，但是现在正在执行的条件跳转指令硬生生跳走了，刚刚提前执行（预取和译码）的指令就嘎了</p><p>引起流水线冒险的原因有很多种，根据类型不同，我们一般分为3种。</p><ul><li>结构冒险：所需的硬件正在为前面的指令工作。</li><li>数据冒险：当前指令需要前面指令的运算数据才能执行。</li><li>控制冒险：需根据之前指令的执行结果决定下一步的行为。</li></ul><p><img loading="lazy" src="https://pic.imgdb.cn/item/62f8a79316f2c2beb1f0406d.png" alt="image-20220814154254723" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="arm体系架构">ARM体系架构<a href="#arm体系架构" class="hash-link" aria-label="ARM体系架构的直接链接" title="ARM体系架构的直接链接">​</a></h2><p>这边我采用先看一遍再重新复习做笔记的方式重新提炼一遍书上的重点（不然不方便复习</p><p>计算机指令集一般分为四种：</p><ul><li>复杂指令集CISC</li><li>精简指令集RISC</li><li>显示并行指令集EPIC</li><li>超长指令字指令集VLIW</li></ul><p>我们一般学习嵌入式的就和RISC打交道（老ARM了，但是我们一般的电脑基本上都是CISC，X86</p><p>RISC有以下特点</p><ul><li>Load/Store架构，CPU不能直接处理内存中的数据，要先将内存中的数据Load（加载）到寄存器中才能操作，然后将处理结果Store（存储）到内存中。(下面会提到汇编的指令)</li><li><strong>固定的指令长度、单周期指令。</strong>（不懂</li><li>倾向于使用更多的寄存器来存储数据，而不是使用内存中的堆栈，效率更高。ARM指令集虽然属于RISC，但是和原汁原味的RISC相比，还是有一些差异的，具体如下。（酱紫存数据不知道寄存器会不会有寿命提前嘎掉，但是x86也是有寄存器的，不懂</li><li>ARM有<strong>桶型移位寄存器</strong>，<strong>单周期</strong>内可以完成数据的各种移位操作。</li><li>并不是所有的ARM指令都是单周期的。</li><li>ARM有16位的Thumb指令集，是32位ARM指令集的压缩形式，提高了代码密度。</li><li>条件执行：通过<strong>指令组合</strong>，减少了分支指令数目，提高了代码密度。</li><li>增加了DSP、SIMD/NEON等指令。</li></ul><p>同时ARM有多种工作模式</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/62ff56a216f2c2beb131b604.png" alt="image-20220819172316504" class="img_ev3q"></p><p>一般正常工作就是user mode，当<strong>程序运行出错或有中断发生</strong>时，ARM处理器就会切换到对应的特权工作模式。用户模式属于普通模式，有些特权指令是运行不了的，需要切换到特权模式下才能运行。在ARM处理器中，除了用户模式是普通模式，剩下的几种工作模式都属于特权模式。</p><p>在ARM处理器内部，除了基本的算术运算单元、逻辑运算单元、浮点运算单元和控制单元，还有一系列寄存器，包括各种通用寄存器、状态寄存器、控制寄存器，用来控制处理器的运行，保存程序运行时的各种状态和临时结果</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/62ff573216f2c2beb132287f.png" alt="image-20220819172541317" class="img_ev3q"></p><p>不想写了，全是汇编</p><p>跳到我们能用的吧</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="程序的编译链接安装和运行">程序的编译、链接、安装和运行<a href="#程序的编译链接安装和运行" class="hash-link" aria-label="程序的编译、链接、安装和运行的直接链接" title="程序的编译、链接、安装和运行的直接链接">​</a></h2><blockquote><p>嵌入式工程师大多数拥有电子、电气、自动化专业背景，不可能像计算机专业的学生那样掌握程序编译过程中的每一个细节，如语法分析、词法分析等。</p></blockquote><p>看来我们要学习编译原理了啊= =</p><p>关于编译原理方面的图书，比较经典的就是“龙书”“虎书”和“鲸书”，此外还有<em>Linkers and Loaders</em>和《程序员的自我修养》。尤其是《程序员的自我修养》这本书，中文语境和写作思维更适合国内的程序员阅读，把程序的编译、链接、运行的各个细节都已经讲得很清楚了。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="从源程序到二进制文件">从源程序到二进制文件<a href="#从源程序到二进制文件" class="hash-link" aria-label="从源程序到二进制文件的直接链接" title="从源程序到二进制文件的直接链接">​</a></h3><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">//sub.c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sub</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//sub.h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sub</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//main.c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(86, 156, 214)">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(206, 145, 120)">&quot;sub.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> global_val </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> uninit_cal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> local_val </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> uninit_local_val </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  a </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">add</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  b </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sub</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">printf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;a=%d\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token function" style="color:rgb(220, 220, 170)">printf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;b=%d\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c编译器扩展语法">C编译器扩展语法<a href="#c编译器扩展语法" class="hash-link" aria-label="C编译器扩展语法的直接链接" title="C编译器扩展语法的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="指定初始化">指定初始化<a href="#指定初始化" class="hash-link" aria-label="指定初始化的直接链接" title="指定初始化的直接链接">​</a></h3><p>当我定义一个数组b<!-- -->[100]<!-- -->，想要初始化b<!-- -->[10]<!-- -->、b<!-- -->[12]<!-- -->为一个非零数值，如果前面还有按固定顺序初始化，那{}里要填充大量的0.</p><p>那C99改进了数组的初始化方式</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">123</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">12</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过数组元素索引，我们可以直接给指定的数组元素赋值。除了数组，一个结构体变量的初始化，也可以通过指定某个结构体成员直接赋值。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="指定初始化数组几个元素">指定初始化数组几个元素<a href="#指定初始化数组几个元素" class="hash-link" aria-label="指定初始化数组几个元素的直接链接" title="指定初始化数组几个元素的直接链接">​</a></h4><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">123</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">51</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">69</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>GNU C支持使用...表示范围扩展，这个特性不仅可以使用在数组初始化中，也可以使用在switch-case语句中，如下面的程序。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/6304b25216f2c2beb1cfb8f7.png" alt="image-20220823185535968" class="img_ev3q"></p><p><strong>这里同样有一个细节需要注意，就是...和其两端的数据范围2和8之间也要有空格，不能写成2...8的形式，否则会报编译错误。</strong></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="指定初始化结构体成员">指定初始化结构体成员<a href="#指定初始化结构体成员" class="hash-link" aria-label="指定初始化结构体成员的直接链接" title="指定初始化结构体成员的直接链接">​</a></h4><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">    FSM_t Gimbal_Fsm </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Current_State</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Last_State</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token constant" style="color:rgb(100, 102, 149)">NULL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">State_Table</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">Gimbal_State_Table</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">State_Change</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">StateChange       </span><span class="token comment" style="color:rgb(106, 153, 85)">//状态机状态变更函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们采用GNU C的初始化方式，通过结构域名.Current_State这些，就可以给结构体变量的某一个指定成员直接赋值。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语句表达式">语句表达式<a href="#语句表达式" class="hash-link" aria-label="语句表达式的直接链接" title="语句表达式的直接链接">​</a></h4><p>GNU C对C语言标准作了扩展，允许在一个表达式里内嵌语句，允许在表达式内部使用局部变量、for循环和goto跳转语句。这种类型的表达式，我们称为语句表达式。语句表达式的格式如下。</p><blockquote><p>（{表达式1;表达式2;})</p></blockquote><p>语句表达式最外面使用小括号()括起来，里面一对大括号{}包起来的是代码块，代码块里允许内嵌各种语句。语句的格式可以是一般表达式，也可以是循环、跳转语句。</p><p>和一般表达式一样，语句表达式也有自己的值。语句表达式的值为内嵌语句中最后一个表达式的值。我们举个例子，使用语句表达式求值。</p><p>例如</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">++</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    i </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                i</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后一句是一个i; 语句，表示整个语句表达式的值</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0长度数组">0长度数组<a href="#0长度数组" class="hash-link" aria-label="0长度数组的直接链接" title="0长度数组的直接链接">​</a></h3><blockquote><p>除了GCC编译器，在其他编译环境下可能就编译错误或者有警告信息。</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用例">使用例<a href="#使用例" class="hash-link" aria-label="使用例的直接链接" title="使用例的直接链接">​</a></h4><p>零长度数组经常以<strong>变长结构体</strong>的形式，在某些特殊的应用场合使用。</p><p>在一个变长结构体中，零长度数组<strong>不占用结构体的存储空间</strong></p><p>但是我们可以通过使用结构体的数组成员去访问内存，非常方便。</p><p>malloc不同大小即可实现不同的数组长度</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/630735a116f2c2beb13bf504.png" alt="image-20220825164026671" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="思考指针与0长数组">思考：指针与0长数组<a href="#思考指针与0长数组" class="hash-link" aria-label="思考：指针与0长数组的直接链接" title="思考：指针与0长数组的直接链接">​</a></h4><blockquote><p>为什么不使用指针来代替零长度数组？</p></blockquote><p>在各种场合，大家可能常常会看到这样的字眼：</p><p>数组名在作为函数参数进行参数传递时，就相当于一个指针。</p><p>注意，我们千万别被这句话迷惑了：数组名在作为参数传递时，传递的确实是一个地址，<strong>但数组名绝不是指针</strong>，两者不是同一个东西。数组名用来表征一块连续内存空间的地址，<strong>而指针是一个变量</strong>，编译器要给它<strong>单独分配一个内存空间，用来存放它指向的变量的地址</strong>。我们看下面的程序。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/630739b416f2c2beb13e395e.png" alt="image-20220825165749392" class="img_ev3q"></p><p>总而言之</p><p>指针远远没有零长度数组用得巧妙：零长度数组不会对结构体定义造成冗余，而且使用起来很方便。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="属性声明section">属性声明：section<a href="#属性声明section" class="hash-link" aria-label="属性声明：section的直接链接" title="属性声明：section的直接链接">​</a></h3><p>GNU C增加了一个<strong>attribute</strong>关键字用来<strong>声明一个函数、变量或类型的特殊属性</strong>。</p><p>声明这个特殊属性有什么用呢？</p><p>主要用途就是指导编译器在<strong>编译程序时进行特定方面的优化或代码检查</strong>。</p><p>例如，我们可以通过属性声明来指定某个变量的数据对齐方式。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/6307413e16f2c2beb143bda0.png" alt="image-20220825172959702" class="img_ev3q"></p><p>需要注意的是，<strong>attribute</strong>后面是两对小括号，不能图方便只写一对，否则编译就会报错。括号里面的ATTRIBUTE表示要声明的属性。目前<strong>attribute</strong>支持十几种属性声明。</p><ul><li>section.</li><li>aligned.</li><li><strong>packed.</strong></li><li>format.</li><li><strong>weak.</strong></li><li>alias.</li><li>noinline.</li><li>always_inline.</li></ul><p>在这些属性中，aligned和packed用来显式<strong>指定一个变量的存储对齐方式</strong>(ps.我们在很多需要字节对齐的地方有用到，但是不知道有什么用）。在正常情况下，当我们定义一个变量时，编译器会根据变量类型给这个变量分配合适大小的存储空间，按照默认的边界对齐方式分配一个地址。而使用<strong>atttribute</strong>这个属性声明，就相当于告诉编译器：按照我们指定的边界对齐方式去给这个变量分配存储空间</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/6307459016f2c2beb1466226.png" alt="image-20220825174825355" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="内联函数">内联函数<a href="#内联函数" class="hash-link" aria-label="内联函数的直接链接" title="内联函数的直接链接">​</a></h3><p>说起内联函数，又不得不说函数调用开销。一个函数在执行过程中，如果需要调用其他函数，则一般会执行下面的过程。</p><p>（1）保存当前函数现场。</p><p>（2）跳到调用函数执行。</p><p>（3）恢复当前函数现场。</p><p>（4）继续执行当前函数。</p><p>如有一个ARM程序，在main()函数中对一些数据进行处理，运算结果暂时保存在R0寄存器中。接着调用另外一个func()函数，调用结束后，返回main()函数继续处理数据。如果我们在func ()函数中要使用R0这个寄存器（用于保存函数的返回值），就会改变R0寄存器中的值，那么就篡改了main ()函数中的暂存运算结果。当我们返回main ()函数继续进行数据处理时，最后的结果肯定不正确。</p><p>那么怎么办呢？很简单，在跳到func()函数执行之前，先把R0寄存器的值保存到堆栈中，func()函数执行结束后，再将堆栈中的值恢复到R0寄存器，这样main()函数就可以继续执行了，就像什么事情都没有发生过一样。</p><p>这种方法被证明是可行的：现在的计算机系统，无论什么架构和指令集，一般都采用这种方法。这种方法虽然麻烦了点，但至少能解决问题，无非就是需要不断地保存现场、恢复现场，这就是函数调用带来的开销。</p><p>对于一般的函数调用，这种方法是没有问题的。但对于一些极端情况，例如，一个函数短小精悍，函数体内只有一行代码，在程序中被大量频繁地调用。如果每次调用，都不断地保存现场，执行时却发现函数只有一行代码，接着又要恢复现场，则来回折腾的开销比较大，性价比不高。这就和你去五星级酒店订个餐位吃饭一样：VIP包间、刀叉餐具、空调、免费的茶水和小菜，服务人员都准备好了，你到了之后只点了一碗面条，吃完之后抹嘴走人，而且一连好多天你都这么干，你说商家会不会对你有意见？</p><p>函数调用也是如此：有些函数短小精悍，而且调用频繁，调用开销大，算下来性价比不高，这时候我们就可以将这个函数声明为内联函数。编译器在编译过程中遇到内联函数，像宏一样，将内联函数直接在调用处展开，这样做就<strong>减少了函数调用的开销：直接执行内联函数展开的代码</strong>，不用再保存现场和恢复现场。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="内联函数与宏">内联函数与宏<a href="#内联函数与宏" class="hash-link" aria-label="内联函数与宏的直接链接" title="内联函数与宏的直接链接">​</a></h4><p>为什么要用inline?</p><ol><li>参数类型检查：内联函数虽然具有宏的展开特性，但其本质仍是函数，在编译过程中，编译器仍可以对其进行参数检查，而宏不具备这个功能。</li><li>便于调试：函数支持的调试功能有断点、单步等，内联函数同样支持。</li><li>返回值：内联函数有返回值，返回一个结果给调用者。这个优势是相对于ANSI C说的，因为现在宏也可以有返回值和类型了，如前面使用语句表达式定义的宏。</li><li>接口封装：有些内联函数可以用来封装一个接口，而宏不具备这个特性。(能封装什么？)</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据存储与指针">数据存储与指针<a href="#数据存储与指针" class="hash-link" aria-label="数据存储与指针的直接链接" title="数据存储与指针的直接链接">​</a></h2><p><img loading="lazy" src="https://pic.imgdb.cn/item/63086d9f16f2c2beb1cd074c.png" alt="image-20220826145135355" class="img_ev3q"></p><p>ANSI C标准为我们提供的32个关键字里，除了控制程序结构的一些关键字，绝大部分都与数据类型和存储相关</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/63086dbf16f2c2beb1cd169f.png" alt="image-20220826145207253" class="img_ev3q"></p><p>很多时候我们编写的程序运行出现问题往往都和数据在内存中的存储有关，一个小小的细节疏忽，程序可能就运行异常了，如<strong>野指针、非法指针、数据溢出、大小端模式</strong>等。</p><p>除此之外，C语言在<strong>类型转换、隐式转换、有符号数与无符号数、数据对齐等方面</strong>也有不少编程陷阱，很多C语言初学者稍微不注意，就有可能栽倒在一个容易疏忽的细节上。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据类型与存储">数据类型与存储<a href="#数据类型与存储" class="hash-link" aria-label="数据类型与存储的直接链接" title="数据类型与存储的直接链接">​</a></h3><p>在一个32位的计算机系统中，通常<strong>4字节</strong>组成<strong>一个字（Word）</strong>，字是软件开发者常用的存储单位。</p><p>一个数据在内存中有2种存储方式：高地址存储高字节数据，低地址存储低字节数据；或者高地址存储低字节数据，而低地址则存储高字节数据。不同字节的数据在内存中的存储顺序被称为<strong>字节序</strong>。根据字节序的不同，我们一般将存储模式分为大端模式和小端模式。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/63086eab16f2c2beb1cd8a33.png" alt="image-20220826145603995" class="img_ev3q"></p><p>不同架构的处理器，存储模式一般也不同。ARM、X86、DSP一般都采用小端模式，而IBM、Sun、PowerPC架构的处理器一般都采用大端模式。</p><p>如何判断程序运行的当前平台是大端模式还是小端模式呢？很简单，我们编写一个程序测试一下就可以知道。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/63086ef516f2c2beb1cdb11a.png" alt="image-20220826145717896" class="img_ev3q"></p><blockquote><p>PS：8bit=1byte 在32位系统，1int = 4byte (4*8=32bit)</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据对齐">数据对齐<a href="#数据对齐" class="hash-link" aria-label="数据对齐的直接链接" title="数据对齐的直接链接">​</a></h3><blockquote><p>这段属实没懂</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/6308797316f2c2beb1d44542.png" alt="image-20220826154203228" class="img_ev3q"></p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="结构体对齐">结构体对齐<a href="#结构体对齐" class="hash-link" aria-label="结构体对齐的直接链接" title="结构体对齐的直接链接">​</a></h3><p>当我们调整结构体成员先后顺序，会发现会变大小，是因为对齐的原因</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/63087ebd16f2c2beb1d78f47.png" alt="image-20220826160437236" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="typedef使用例">typedef使用例<a href="#typedef使用例" class="hash-link" aria-label="typedef使用例的直接链接" title="typedef使用例的直接链接">​</a></h3><p><img loading="lazy" src="https://pic.imgdb.cn/item/6308804016f2c2beb1d8b9cd.png" alt="image-20220826161104596" class="img_ev3q"></p><p>感觉会好看一点</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="和函数指针结合">和函数指针结合<a href="#和函数指针结合" class="hash-link" aria-label="和函数指针结合的直接链接" title="和函数指针结合的直接链接">​</a></h4><p><img loading="lazy" src="https://pic.imgdb.cn/item/6308809816f2c2beb1d90c2e.png" alt="image-20220826161232197" class="img_ev3q"></p><p><img loading="lazy" src="https://pic.imgdb.cn/item/6308813b16f2c2beb1d9b697.png" alt="image-20220826161515270" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="与枚举结合">与枚举结合<a href="#与枚举结合" class="hash-link" aria-label="与枚举结合的直接链接" title="与枚举结合的直接链接">​</a></h4><p><img loading="lazy" src="https://pic.imgdb.cn/item/63109cc016f2c2beb1703983.png" alt="image-2022082616151570" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="oop面向对象">OOP面向对象<a href="#oop面向对象" class="hash-link" aria-label="OOP面向对象的直接链接" title="OOP面向对象的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="代码复用与分层思想">代码复用与分层思想<a href="#代码复用与分层思想" class="hash-link" aria-label="代码复用与分层思想的直接链接" title="代码复用与分层思想的直接链接">​</a></h3><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="面向对象编程基础">面向对象编程基础<a href="#面向对象编程基础" class="hash-link" aria-label="面向对象编程基础的直接链接" title="面向对象编程基础的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="类的封装和实例化">类的封装和实例化<a href="#类的封装和实例化" class="hash-link" aria-label="类的封装和实例化的直接链接" title="类的封装和实例化的直接链接">​</a></h4><p>class的概念可以用一个结构体打包</p><p>属性就扔个变量</p><p>方法就扔个函数指针</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">typedef</span><span class="token plain"> __packed </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    REMOTE_t </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">RC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">//遥控器主结构体</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    FSM_t </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">Gimbal_Fsm</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Grasp_t </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">Graps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//    void (*Lift_Up_fun)(Lift_UP_t*,int16_t);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">PowerOff</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Grasp_t</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token comment" style="color:rgb(106, 153, 85)">//云台断电</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">Gimbal_t</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面两个便是函数指针</p><p>继承，就把父类结构体扔到子类结构体里，多态也亦如此</p><p>（其实面向对象也就这些了</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linux内核oop">Linux内核OOP<a href="#linux内核oop" class="hash-link" aria-label="Linux内核OOP的直接链接" title="Linux内核OOP的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="链表抽象与封装">链表抽象与封装<a href="#链表抽象与封装" class="hash-link" aria-label="链表抽象与封装的直接链接" title="链表抽象与封装的直接链接">​</a></h4><p><img loading="lazy" src="https://pic.imgdb.cn/item/63131b0a16f2c2beb1dbe72d.png" alt="image-20220903171357660" class="img_ev3q"></p><p>这是Linux内核中为了实现对链表操作的代码复用，定义了一个通用的链表及相关操作。</p><p>你会发现这个listhead并没有用到数据域，</p><p>其实，我们可以将结构类型list_head及相关的操作看成一个<strong>基类</strong>，其他子类如果想继承子类的属性和方法，<strong>直接将list_head内嵌到自己的结构体内即可。</strong></p><p><img loading="lazy" src="https://pic.imgdb.cn/item/63131b5816f2c2beb1dc38b4.png" alt="image-20220903171515040" class="img_ev3q"></p><p><img loading="lazy" src="https://pic.imgdb.cn/item/63131b9c16f2c2beb1dc89f6.png" alt="image-20220903171623517" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="继承与私有指针">继承与私有指针<a href="#继承与私有指针" class="hash-link" aria-label="继承与私有指针的直接链接" title="继承与私有指针的直接链接">​</a></h4><p>为了更好地使用OOP思想理解内核源码，我们可以把继承的概念定义得更宽松一点，除了内嵌结构体，C语言还可以有其他方法来模拟类的继承，如通过私有指针。</p><p>我们可以把使用<strong>结构体类型</strong>定义各个不同的<strong>结构体变量</strong>，也可以看作继承，各个<strong>结构体变量</strong>就是子类，然后各个子类通过私有指针扩展各自的属性或方法。</p><p>这种继承方法主要适用于父类和子类差别不大的场合。如Linux内核中的网卡设备，不同厂家的网卡、不同速度的网卡，以及相同厂家不同品牌的网卡，它们的读写操作基本上都是一样的，都通过标准的网络协议传输数据，唯一不同的就是不同网卡之间存在一些差异，如I/O寄存器、I/O内存地址、中断号等硬件资源不相同。</p><p>遇到这些设备，我们完全不必给每个类型的网卡都实现一个结构体。我们可以将各个网卡一些相同的属性抽取出来，构建一个通用的结构体net_device，然后通过一个私有指针，指向每个网卡各自不同的属性和方法，通过这种设计可以最大程度地实现代码复用。如Linux内核中的net_device结构体。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/63131cc616f2c2beb1ddd79c.png" alt="image-20220903172121548" class="img_ev3q"></p><p>在net_device结构体定义中，我们可以看到一个私有指针成员变量：ml_priv。</p><p>当我们使用该结构体类型定义不同的变量来表示不同型号的网卡设备时，这个私有指针就会指向各个网卡自身扩展的一些属性。</p><p>如在bfin_can.c文件中，bfin_can这种类型的网卡自定义了一个结构体，用来保存自己的I/O内存地址、接收中断号、发送中断号等。</p><p><img loading="lazy" src="https://pic.imgdb.cn/item/63131d6b16f2c2beb1de9a63.png" alt="image-20220903172406722" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/upgrade-your-fuxking-compiler"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">升级AC6编译器（支持Cmake）</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/usb-application"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">usb从实践到理论</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#工欲善其事必先利其器" class="table-of-contents__link toc-highlight">工欲善其事，必先利其器</a><ul><li><a href="#程序编译工具make" class="table-of-contents__link toc-highlight">程序编译工具：make</a><ul><li><a href="#使用gcc编译c源程序" class="table-of-contents__link toc-highlight">使用gcc编译C源程序</a></li><li><a href="#make编译工具" class="table-of-contents__link toc-highlight">make编译工具</a></li></ul></li></ul></li><li><a href="#cpu性能提升流水线" class="table-of-contents__link toc-highlight">CPU性能提升：流水线</a><ul><li><a href="#流水线工作原理" class="table-of-contents__link toc-highlight">流水线工作原理</a></li><li><a href="#超流水线技术" class="table-of-contents__link toc-highlight">超流水线技术</a></li><li><a href="#流水线冒险hazard" class="table-of-contents__link toc-highlight">流水线冒险（hazard）</a></li></ul></li><li><a href="#arm体系架构" class="table-of-contents__link toc-highlight">ARM体系架构</a></li><li><a href="#程序的编译链接安装和运行" class="table-of-contents__link toc-highlight">程序的编译、链接、安装和运行</a><ul><li><a href="#从源程序到二进制文件" class="table-of-contents__link toc-highlight">从源程序到二进制文件</a></li></ul></li><li><a href="#c编译器扩展语法" class="table-of-contents__link toc-highlight">C编译器扩展语法</a><ul><li><a href="#指定初始化" class="table-of-contents__link toc-highlight">指定初始化</a><ul><li><a href="#指定初始化数组几个元素" class="table-of-contents__link toc-highlight">指定初始化数组几个元素</a></li><li><a href="#指定初始化结构体成员" class="table-of-contents__link toc-highlight">指定初始化结构体成员</a></li><li><a href="#语句表达式" class="table-of-contents__link toc-highlight">语句表达式</a></li></ul></li><li><a href="#0长度数组" class="table-of-contents__link toc-highlight">0长度数组</a><ul><li><a href="#使用例" class="table-of-contents__link toc-highlight">使用例</a></li><li><a href="#思考指针与0长数组" class="table-of-contents__link toc-highlight">思考：指针与0长数组</a></li></ul></li><li><a href="#属性声明section" class="table-of-contents__link toc-highlight">属性声明：section</a></li><li><a href="#内联函数" class="table-of-contents__link toc-highlight">内联函数</a><ul><li><a href="#内联函数与宏" class="table-of-contents__link toc-highlight">内联函数与宏</a></li></ul></li></ul></li><li><a href="#数据存储与指针" class="table-of-contents__link toc-highlight">数据存储与指针</a><ul><li><a href="#数据类型与存储" class="table-of-contents__link toc-highlight">数据类型与存储</a></li><li><a href="#数据对齐" class="table-of-contents__link toc-highlight">数据对齐</a></li><li><a href="#结构体对齐" class="table-of-contents__link toc-highlight">结构体对齐</a></li><li><a href="#typedef使用例" class="table-of-contents__link toc-highlight">typedef使用例</a><ul><li><a href="#和函数指针结合" class="table-of-contents__link toc-highlight">和函数指针结合</a></li><li><a href="#与枚举结合" class="table-of-contents__link toc-highlight">与枚举结合</a></li></ul></li></ul></li><li><a href="#oop面向对象" class="table-of-contents__link toc-highlight">OOP面向对象</a><ul><li><a href="#代码复用与分层思想" class="table-of-contents__link toc-highlight">代码复用与分层思想</a></li><li><a href="#面向对象编程基础" class="table-of-contents__link toc-highlight">面向对象编程基础</a><ul><li><a href="#类的封装和实例化" class="table-of-contents__link toc-highlight">类的封装和实例化</a></li></ul></li><li><a href="#linux内核oop" class="table-of-contents__link toc-highlight">Linux内核OOP</a><ul><li><a href="#链表抽象与封装" class="table-of-contents__link toc-highlight">链表抽象与封装</a></li><li><a href="#继承与私有指针" class="table-of-contents__link toc-highlight">继承与私有指针</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tags">标签</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">归档</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/skill">技术笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/project">实战项目</a></li></ul></div><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/pansyhou" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/friends">友链</a></li><li class="footer__item"><a class="footer__link-item" position="right" href="/resource">导航</a></li><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank"><img style="height:50px;margin-top:0.5rem" src="/img/buildwith.png"><a></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p>Copyright © 2020 - PRESENT pansyhou Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.b46bdf30.js"></script>
<script src="/assets/js/main.1772e4c3.js"></script>
</body>
</html>